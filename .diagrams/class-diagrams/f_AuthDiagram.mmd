classDiagram
    title Auth Feature Architecture
    %% This diagram illustrates the architecture of the Authentication feature,
    %% following a layered approach: Feature (ViewModels) -> Domain (UseCases, Repository Interfaces) -> Data (Repository Implementations, DataSources).
    %% Data Flow: External services (e.g., Firebase Auth, Firestore) are accessed by DataSource Implementations,
    %% which are abstracted by DataSource Interfaces. Repository Implementations use these DataSource Interfaces
    %% and are themselves abstracted by Repository Interfaces. UseCases consume Repository Interfaces to orchestrate
    %% domain logic, and ViewModels use UseCases to manage UI state and handle user interactions.
    %% UI (Activities/Fragments/Composables) would observe ViewModels.

    %% Feature Layer (ViewModels)
    %% ViewModels are responsible for preparing and managing data for the UI.
    %% They interact with UseCases to get data and process user actions.
    %% UI models are implicitly managed here, often as StateFlow/LiveData exposed to the UI.
    subgraph Feature Layer - ViewModels
        direction LR
        namespace ViewModels_AuthNS {
            class SplashViewModel {
                -checkSessionUseCase: CheckSessionUseCase
                -checkAuthStatusUseCase: CheckAuthenticationStatusUseCase
                +onAppStart()
            }

            class LoginViewModel {
                -loginUseCase: LoginUseCase
                -getAuthErrorMessageUseCase: GetAuthErrorMessageUseCase
                +login(email, password)
            }

            class SignUpViewModel {
                -signUpUseCase: SignUpUseCase
                -checkNicknameAvailabilityUseCase: CheckNicknameAvailabilityUseCase
                -sendEmailVerificationUseCase: SendEmailVerificationUseCase
                -getAuthErrorMessageUseCase: GetAuthErrorMessageUseCase
                +signUp(email, password, nickname)
                +sendVerificationEmail()
            }

            class FindPasswordViewModel {
                -requestPasswordResetUseCase: RequestPasswordResetUseCase
                -verifyPasswordResetCodeUseCase: VerifyPasswordResetCodeUseCase
                -resetPasswordUseCase: ResetPasswordUseCase
                -getAuthErrorMessageUseCase: GetAuthErrorMessageUseCase
                +requestPasswordReset(email)
                +verifyCodeAndResetPassword(code, newPassword)
            }

            class TermsOfServiceViewModel { %% Static content, likely just displays terms. No complex data flow.
            }
            class PrivacyPolicyViewModel { %% Static content, likely just displays policy. No complex data flow.
            }
        }
    end
    %% Existing notes provide basic descriptions, new notes aim to elaborate on roles and flow.
    %% note for SplashViewModel "스플래시 화면 UI 로직 및 세션 확인"
    %% note for LoginViewModel "로그인 화면 UI 로직"
    %% note for SignUpViewModel "회원가입 화면 UI 로직"
    %% note for FindPasswordViewModel "비밀번호 찾기 화면 UI 로직"
    %% note for TermsOfServiceViewModel "서비스 이용약관 표시"
    %% note for PrivacyPolicyViewModel "개인정보처리방침 표시"

    %% Domain Layer (UseCases & Repository Interfaces)
    %% UseCases encapsulate specific business logic operations. They are called by ViewModels.
    %% Repository Interfaces define contracts for data access, abstracting the Data layer.
    %% Domain models are used here, representing core business entities/data structures.
    subgraph Domain Layer
        direction LR
        namespace UseCases_AuthNS {
            class CheckSessionUseCase
            class CheckAuthenticationStatusUseCase
            class LoginUseCase
            class GetAuthErrorMessageUseCase
            class SignUpUseCase
            class SendEmailVerificationUseCase
            class RequestPasswordResetUseCase
            class VerifyPasswordResetCodeUseCase
            class ResetPasswordUseCase
        }
        namespace UseCases_UserNS {
            class CheckNicknameAvailabilityUseCase
        }

        namespace Repositories_DomainNS {
            class AuthRepository {
                <<Interface>>
                +checkSession(): Flow<Boolean>
                +observeAuthenticationStatus(): Flow<Boolean>
                +login(email, password): Result<Unit>
                +signUp(email, password): Result<String> %% Returns UID
                +sendEmailVerification(): Result<Unit>
                +requestPasswordReset(email: String): Result<Unit>
                +verifyPasswordResetCode(code: String): Result<String> %% Returns email or token
                +resetPassword(code: String, newPassword: String): Result<Unit>
                +getCurrentUserId(): String?
            }

            class UserRepository {
                <<Interface>>
                +isNicknameAvailable(nickname: String): Result<Boolean>
                +createUserProfile(uid: String, email: String, nickname: String): Result<Unit>
            }
        }
        %% note for UserRepository "사용자 데이터 접근 추상화 인터페이스 (Auth에서 일부 사용)" (Covered by new note)
    end

    %% Data Layer (Repository Implementation & Remote DataSources - Local Excluded)
    %% Repository Implementations provide concrete implementations of Repository Interfaces using DataSources.
    %% DataSource Interfaces define contracts for accessing specific data sources (remote or local).
    %% DataSource Implementations provide concrete implementations for these interfaces (e.g., using Firebase).
    %% Data models (DTOs - Data Transfer Objects) are typically used at this layer for communication with external services.
    subgraph Data Layer
        direction LR
        namespace RepositoryImpl_DataNS {
            class AuthRepositoryImpl {
                -authRemoteDataSource: AuthRemoteDataSource
            }
            class UserRepositoryImpl {
                -userRemoteDataSource: UserRemoteDataSource
            }
        }
        %% note for AuthRepositoryImpl "AuthRepository 구현체 (Remote)" (Covered)
        %% note for UserRepositoryImpl "UserRepository 구현체 (Remote, Auth에서 사용되는 부분)" (Covered)

        namespace RemoteDataSources_DataNS {
            class AuthRemoteDataSource {
                <<Interface>>
                +login(email, password): Result<String> %% UID
                +signUp(email, password): Result<String> %% UID
                +sendEmailVerification(): Result<Unit>
                +requestPasswordReset(email: String): Result<Unit>
                +verifyPasswordResetCode(code: String): Result<String> %% email
                +resetPasswordWithCode(code: String, newPassword: String): Result<Unit>
                +observeAuthState(): Flow<String?> %% UID or null
                +getCurrentUserId(): String?
            }
            class UserRemoteDataSource {
                <<Interface>>
                +isNicknameAvailable(nickname: String): Result<Boolean>
                +createUser(userDto: UserDTO): Result<Unit>
            }
        }
        %% note for AuthRemoteDataSource "원격 인증 서비스(Firebase Auth) 통신" (Covered)
        %% note for UserRemoteDataSource "원격 사용자 데이터 서비스(Firestore) 통신 (Auth에서 사용되는 부분)" (Covered)

        namespace DataSourceImpl_DataNS {
            class AuthRemoteDataSourceImpl {
                -firebaseAuth: FirebaseAuth
            }
            class UserRemoteDataSourceImpl {
                -firestore: FirebaseFirestore
            }
        }
    end

    %% ===== Relationships =====
    %% ViewModel -> UseCase
    SplashViewModel ..> CheckSessionUseCase : uses
    SplashViewModel ..> CheckAuthenticationStatusUseCase : uses
    LoginViewModel ..> LoginUseCase : uses
    LoginViewModel ..> GetAuthErrorMessageUseCase : uses
    SignUpViewModel ..> SignUpUseCase : uses
    SignUpViewModel ..> CheckNicknameAvailabilityUseCase : uses
    SignUpViewModel ..> SendEmailVerificationUseCase : uses
    SignUpViewModel ..> GetAuthErrorMessageUseCase : uses
    FindPasswordViewModel ..> RequestPasswordResetUseCase : uses
    FindPasswordViewModel ..> VerifyPasswordResetCodeUseCase : uses
    FindPasswordViewModel ..> ResetPasswordUseCase : uses
    FindPasswordViewModel ..> GetAuthErrorMessageUseCase : uses

    %% UseCase -> Repository Interface
    CheckSessionUseCase ..> AuthRepository : accesses
    CheckAuthenticationStatusUseCase ..> AuthRepository : accesses
    LoginUseCase ..> AuthRepository : accesses
    SignUpUseCase ..> AuthRepository : for auth operations
    SignUpUseCase ..> UserRepository : for profile creation
    SendEmailVerificationUseCase ..> AuthRepository : accesses
    RequestPasswordResetUseCase ..> AuthRepository : accesses
    VerifyPasswordResetCodeUseCase ..> AuthRepository : accesses
    ResetPasswordUseCase ..> AuthRepository : accesses
    CheckNicknameAvailabilityUseCase ..> UserRepository : accesses

    %% Repository Implementation -> Repository Interface
    AuthRepository <|.. AuthRepositoryImpl : implements
    UserRepository <|.. UserRepositoryImpl : implements

    %% Repository Implementation -> DataSource Interface (Remote Only)
    AuthRepositoryImpl ..> AuthRemoteDataSource : uses
    UserRepositoryImpl ..> UserRemoteDataSource : uses

    %% DataSource Implementation -> DataSource Interface
    AuthRemoteDataSource <|.. AuthRemoteDataSourceImpl : implements
    UserRemoteDataSource <|.. UserRemoteDataSourceImpl : implements
